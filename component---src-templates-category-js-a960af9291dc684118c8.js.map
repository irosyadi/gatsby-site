{"version":3,"sources":["webpack:///./src/templates/category.js"],"names":["Wrapper","_styled2","target","name","styles","_ref3","_ref4","_ref","data","location","posts","allMarkdownRemark","edges","countOfInitialPost","site","siteMetadata","configs","categoryTitle","String","pathname","split","join","trim","_useCount","useCount","count","countRef","increaseCount","bottomRef","useRef","_useState","useState","tag","filteredPosts","state","setState","tags","useMemo","result","map","_ref2","node","concat","_toConsumableArray","frontmatter","i","length","j","splice","setFilteredPosts","useCallback","undefined","filter","post","includes","useInfiniteScroll","current","useEffect","href","queryString","parseUrl","query","___EmotionJSX","Layout","SEO","title","Profile","className","css","CategoryMenu","path","TagSelector","onTagClick","navigate","slice","index","Post","key","ref"],"mappings":"wRAaA,IAAMA,EAAOC,YAAA,OAAAC,OAAA,YAAAD,CAAA,CAAAE,KAAA,UAAAC,OAAA,mEAAyCC,EAAA,CAAAF,KAAA,UAAAC,OAAA,2FAAAE,EAAA,CAAAH,KAAA,SAAAC,OAAA,yDAEvC,mBAAAG,GAAyB,IAAtBC,EAAID,EAAJC,KAAMC,EAAQF,EAARE,SAChBC,EAAQF,EAAKG,kBAAkBC,MAC7BC,EAAuBL,EAAKM,KAAKC,aAAaC,QAA9CH,mBACFI,EAAgBC,OAAOT,EAASU,UAAUC,MAAM,KAAKC,KAAK,KAAKC,OAAMC,EAElCC,YAASP,GAA3CQ,EAAKF,EAAA,GAAEG,EAAQH,EAAA,GAAEI,EAAaJ,EAAA,GAC/BK,EAAYC,mBAAQC,EAEAC,mBAAS,CACjCC,IAAK,MACLC,cAAevB,IAFVwB,EAAKJ,EAAA,GAAEK,EAAQL,EAAA,GAKhBM,EAAOC,mBAAQ,WACnB,IAAIC,EAAS,GACb5B,EAAM6B,KAAI,SAAAC,GAAA,IAAGC,EAAID,EAAJC,KAAI,OAAQH,EAAM,GAAAI,OAAAC,YAAOL,GAAMK,YAAKF,EAAKG,YAAYR,UAClE,IAAK,IAAIS,EAAI,EAAGA,EAAIP,EAAOQ,SAAUD,EACnC,IAAK,IAAIE,EAAIF,EAAI,EAAGE,EAAIT,EAAOQ,SAAUC,EACnCT,EAAOO,KAAOP,EAAOS,IAAIT,EAAOU,OAAOD,IAAK,GAGpD,OAAOT,IACN,CAAC5B,IAEEuC,EAAmBC,uBACvB,SAAClB,QACamB,IAARnB,IAAmBA,EAAME,EAAMF,KAEjCG,EADU,QAARH,EACO,CACPA,IAAKA,EACLC,cAAevB,GAGR,CACPsB,IAAKA,EACLC,cAAevB,EAAM0C,QAAO,SAACC,GAAI,OAC/BA,EAAKZ,KAAKG,YAAYR,KAAKkB,SAAStB,UAK5C,CAACtB,EAAOwB,EAAMF,MAGhBuB,aAAkB,WACZ7C,EAAMoC,OAASpB,EAAS8B,QAAU3C,IACpCc,IACAsB,OAEDrB,GAkBH,OAXA6B,qBAAU,WACR,GAAIhD,EAASiD,KAAM,CAAC,IAEP1B,EACP2B,IAAYC,SAASnD,EAASiD,MADhCG,MAAS7B,IAEPA,GACFiB,EAAiBjB,MAGpB,CAACvB,EAASiD,KAAMT,IAGjBa,YAACC,IAAM,KACLD,YAACE,IAAG,CAACC,MAAOhD,IACZ6C,YAAC9D,EAAO,KACN8D,YAACI,IAAO,MACRJ,YAAA,MAAIK,UAAU,iBAAiBC,IAAG/D,GAAmC,IACjEY,IAGN6C,YAACO,IAAY,CAACC,KAAM7D,EAASU,WAC7B2C,YAAC9D,EAAO,KACN8D,YAACS,IAAW,CAACnC,KAAMA,EAAMoC,WA3BZ,SAACxC,GAClByC,mBAAS,QAAQzC,GACjBiB,EAAiBjB,IAyBoCE,MAAOA,IACxB,IAA/BA,EAAMD,cAAca,QACnBgB,YAAA,OAAKM,IAAG9D,GAAmB,aAE5B4B,EAAMD,cACJyC,MAAM,EAAGjD,EAAQZ,GACjB0B,KAAI,SAACc,EAAMsB,GACV,OAAOb,YAACc,IAAI,CAACvB,KAAMA,EAAMwB,IAAG,QAAUF,QAG5Cb,YAAA,OAAKgB,IAAKlD","file":"component---src-templates-category-js-a960af9291dc684118c8.js","sourcesContent":["import tw from \"twin.macro\"\nimport React, { useMemo, useState, useEffect, useCallback, useRef } from \"react\"\nimport SEO from \"../components/seo\"\nimport Profile from \"../components/Profile\"\nimport Post from \"../components/Post\"\nimport Layout from \"../components/Layout\"\nimport { graphql, navigate } from \"gatsby\"\nimport queryString from \"query-string\"\nimport TagSelector from \"../components/TagSelector\"\nimport useInfiniteScroll from \"../lib/hooks/useInfiniteScroll\"\nimport useCount from \"../lib/hooks/useCount\"\nimport CategoryMenu from \"../components/CategoryMenu\"\n\nconst Wrapper = tw.div`w-full max-w-screen-md mx-auto`\n\nexport default ({ data, location }) => {\n  const posts = data.allMarkdownRemark.edges\n  const { countOfInitialPost } = data.site.siteMetadata.configs\n  const categoryTitle = String(location.pathname).split(\"/\").join(\" \").trim()\n\n  const [count, countRef, increaseCount] = useCount(categoryTitle)\n  const bottomRef = useRef()\n\n  const [state, setState] = useState({\n    tag: \"ALL\",\n    filteredPosts: posts,\n  })\n\n  const tags = useMemo(() => {\n    var result = []\n    posts.map(({ node }) => (result = [...result, ...node.frontmatter.tags]))\n    for (var i = 0; i < result.length; ++i) {\n      for (var j = i + 1; j < result.length; ++j) {\n        if (result[i] === result[j]) result.splice(j--, 1)\n      }\n    }\n    return result\n  }, [posts])\n\n  const setFilteredPosts = useCallback(\n    (tag) => {\n      if (tag === undefined) tag = state.tag\n      if (tag === \"ALL\") {\n        setState({\n          tag: tag,\n          filteredPosts: posts,\n        })\n      } else {\n        setState({\n          tag: tag,\n          filteredPosts: posts.filter((post) =>\n            post.node.frontmatter.tags.includes(tag)\n          ),\n        })\n      }\n    },\n    [posts, state.tag]\n  )\n\n  useInfiniteScroll(() => {\n    if (posts.length > countRef.current * countOfInitialPost) {\n      increaseCount()\n      setFilteredPosts()\n    }\n  }, bottomRef)\n\n  const onTagClick = (tag) => {\n    navigate(`?tag=${tag}`)\n    setFilteredPosts(tag)\n  }\n\n  useEffect(() => {\n    if (location.href) {\n      const {\n        query: { tag },\n      } = queryString.parseUrl(location.href)\n      if (tag) {\n        setFilteredPosts(tag)\n      }\n    }\n  }, [location.href, setFilteredPosts])\n\n  return (\n    <Layout>\n      <SEO title={categoryTitle} />\n      <Wrapper>\n        <Profile />\n        <h1 className=\"category-title\" css={tw`mt-4 px-4 text-4xl font-bold`}>\n          #{categoryTitle}\n        </h1>\n      </Wrapper>\n      <CategoryMenu path={location.pathname} />\n      <Wrapper>\n        <TagSelector tags={tags} onTagClick={onTagClick} state={state} />\n        {state.filteredPosts.length === 0 && (\n          <div css={tw`mx-4 text-xl`}>no post..</div>\n        )}\n        {state.filteredPosts\n          .slice(0, count * countOfInitialPost)\n          .map((post, index) => {\n            return <Post post={post} key={`post_${index}`} />\n          })}\n      </Wrapper>\n      <div ref={bottomRef} />\n    </Layout>\n  )\n}\n\nexport const pageQuery = graphql`\n  query($categoryRegex: String) {\n    site {\n      siteMetadata {\n        configs {\n          countOfInitialPost\n        }\n      }\n    }\n    allMarkdownRemark(\n      sort: { fields: [frontmatter___date], order: DESC }\n      filter: {\n        fileAbsolutePath: { regex: $categoryRegex }\n        frontmatter: { draft: { eq: false } }\n      }\n    ) {\n      edges {\n        node {\n          excerpt(pruneLength: 200, truncate: true)\n          fields {\n            slug\n          }\n          frontmatter {\n            date(formatString: \"ddd, MMM D, YYYY\")\n            title\n            tags\n          }\n        }\n      }\n    }\n  }\n`\n"],"sourceRoot":""}